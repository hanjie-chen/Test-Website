services:
  web-app:
    build:
      context: ./web-app
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    volumes:
      - articles_data:/articles-data:ro
      # bind mount used to develop env, need to delete when product env
      - ./web-app:/app
    environment:
      - ARTICLES_DIRECTORY=/articles-data
      - FLASK_APP=app.py
    develop:
      watch:
        - path: ./web-app
          target: /app
          action: sync+restart

  articles-data:
    build:
      context: ./articles-data
      dockerfile: Dockerfile
    volumes:
      - articles_data:/articles-data:rw
    environment:
      - GITHUB_REPO=https://github.com/hanjie-chen/PersonalArticles.git
      - REPO_BRANCH=main
      - LOG_DIR=/var/log/personal-website
    develop:
      watch:
        - path: ./articles-data
          action: restart

volumes:
  articles_data:
